{"version":3,"file":"mini-vue.cjs.js","sources":["../src/shared/shapeFlags.ts","../src/runtime-core/vnode.ts","../src/runtime-core/h.ts","../src/runtime-core/componentPublicInstance.ts","../src/runtime-core/component.ts","../src/runtime-core/renderer.ts","../src/runtime-core/createApp.ts"],"sourcesContent":["// 组件的类型\r\nexport const enum ShapeFlags {\r\n  // 最后要渲染的 element 类型\r\n  //ELEMENT -> 0001;\r\n  // STATEFUL_COMPONENT 0010\r\n  // TEXT_CHILDREN 0100\r\n  // ARRAY_CHILDREN 1000\r\n  ELEMENT = 1, \r\n  // 组件类型\r\n  STATEFUL_COMPONENT = 1 << 1,\r\n  // vnode 的 children 为 string 类型\r\n  TEXT_CHILDREN = 1 << 2,\r\n  // vnode 的 children 为数组类型\r\n  ARRAY_CHILDREN = 1 << 3,\r\n}\r\n","import { ShapeFlags } from \"../shared/shapeFlags\";\r\n\r\nexport function createVNode(type, props?, children?) {\r\n  const vnode = {\r\n    type,\r\n    props,\r\n    children,\r\n    shapeFlag: getShapeFlag(type),\r\n    el: null,\r\n  };\r\n  // children\r\n  if (typeof children === \"string\") {\r\n    vnode.shapeFlag |= ShapeFlags.TEXT_CHILDREN;\r\n  } else if (Array.isArray(children)) {\r\n    vnode.shapeFlag |= ShapeFlags.ARRAY_CHILDREN;\r\n  }\r\n\r\n  return vnode;\r\n}\r\n\r\nfunction getShapeFlag(type: any) {\r\n  return typeof type === \"string\"\r\n    ? ShapeFlags.ELEMENT\r\n    : ShapeFlags.STATEFUL_COMPONENT;\r\n}\r\n","import { createVNode } from \"./vnode\";\r\nexport const h = (type: string, props: any, children: string | Array<any>) => {\r\n  return createVNode(type, props, children);\r\n};\r\n","const publicPropertiesMap = {\r\n  // 当用户调用 instance.proxy.$emit 时就会触发这个函数\r\n  // i 就是 instance 的缩写 也就是组件实例对象\r\n  $el: (i) => i.vnode.el,\r\n};\r\n\r\n// todo 需要让用户可以直接在 render 函数内直接使用 this 来触发 proxy\r\nexport const PublicInstanceProxyHandlers = {\r\n  get({ _: instance }, key) {\r\n    // setupState\r\n    const { setupState } = instance;\r\n    if (key in setupState) {\r\n      return setupState[key];\r\n    }\r\n    const publicGetter = publicPropertiesMap[key];\r\n\r\n    if (publicGetter) {\r\n      return publicGetter(instance);\r\n    }\r\n  },\r\n};\r\n","import { PublicInstanceProxyHandlers } from \"./componentPublicInstance\";\r\n\r\nexport function createComponentInstance(vnode) {\r\n  const component = {\r\n    type: vnode.type,\r\n    vnode,\r\n    setupState: {},\r\n  };\r\n\r\n  return component;\r\n}\r\n\r\nexport function setupComponent(instance) {\r\n  // initProps()\r\n  // initSlots()\r\n\r\n  setupStatefulComponent(instance);\r\n}\r\n\r\nfunction setupStatefulComponent(instance: any) {\r\n  // 获取到用户给到的配置\r\n  const Component = instance.type;\r\n  // ctx\r\n  instance.proxy = new Proxy({ _: instance }, PublicInstanceProxyHandlers);\r\n\r\n  const { setup } = Component;\r\n  if (setup) {\r\n    // function Object\r\n\r\n    const setupResult = setup();\r\n    handleSetupResult(instance, setupResult);\r\n  }\r\n}\r\n\r\nfunction handleSetupResult(instance: any, setupResult: any) {\r\n  if (typeof setupResult === \"object\") {\r\n    instance.setupState = setupResult;\r\n  }\r\n\r\n  finishComponentSetup(instance);\r\n}\r\n\r\nfunction finishComponentSetup(instance: any) {\r\n  const Component = instance.type;\r\n  if (Component.render) {\r\n    instance.render = Component.render;\r\n  }\r\n}\r\n","import { isObject } from \"../shared\";\r\nimport { ShapeFlags } from \"../shared/shapeFlags\";\r\nimport { createComponentInstance, setupComponent } from \"./component\";\r\n\r\nexport function render(vnode, container) {\r\n  // path\r\n  patch(vnode, container);\r\n}\r\n\r\nfunction patch(vnode, container) {\r\n  // 判断Vnode是不是一个element\r\n  // 是element 那么 就应该处理element\r\n  // 如何判断是element类型还是component类型\r\n  // 可以通过type的类型来判断\r\n  const { shapeFlag } = vnode;\r\n\r\n  if (shapeFlag & ShapeFlags.ELEMENT) {\r\n    processElement(vnode, container);\r\n  } else if (shapeFlag & ShapeFlags.STATEFUL_COMPONENT) {\r\n    processComponent(vnode, container);\r\n  }\r\n}\r\nfunction processElement(vnode: any, container: any) {\r\n  // 先初始化\r\n  mountElement(vnode, container);\r\n}\r\n\r\nfunction processComponent(vnode, container) {\r\n  mountComponent(vnode, container);\r\n}\r\n\r\nfunction mountElement(vnode: any, container: any) {\r\n  const el = (vnode.el = document.createElement(vnode.type));\r\n  // string array\r\n  const { children, shapeFlag } = vnode;\r\n  if (shapeFlag & ShapeFlags.TEXT_CHILDREN) {\r\n    el.textContent = children;\r\n  } else if (shapeFlag & ShapeFlags.ARRAY_CHILDREN) {\r\n    // vnode\r\n    mountChildren(vnode, el);\r\n  }\r\n  // props\r\n  const { props } = vnode;\r\n\r\n  for (const key in props) {\r\n    const val = props[key];\r\n    el.setAttribute(key, val);\r\n  }\r\n  container.append(el);\r\n}\r\n\r\nfunction mountChildren(vnode, container) {\r\n  vnode.children.forEach((v) => {\r\n    patch(v, container);\r\n  });\r\n}\r\n\r\nfunction mountComponent(initialVNode: any, container) {\r\n  const instance = createComponentInstance(initialVNode);\r\n  setupComponent(instance);\r\n  setupRenderEffect(instance, initialVNode, container);\r\n}\r\n\r\nfunction setupRenderEffect(instance: any, initialVNode: any, container) {\r\n  const { proxy } = instance;\r\n  const subTree = instance.render.call(proxy);\r\n\r\n  // vnode -> patch\r\n  // vnode -> element\r\n\r\n  patch(subTree, container);\r\n\r\n  initialVNode.el = subTree.el;\r\n}\r\n","import { render } from \"./renderer\";\r\nimport { createVNode } from \"./vnode\";\r\n\r\nexport function createApp(rootComponent) {\r\n  return {\r\n    mount(rootContainer) {\r\n      // 先转换为vnode\r\n      // 所有的逻辑操作都会基于vnode做处理\r\n      const vnode = createVNode(rootComponent);\r\n\r\n      render(vnode, rootContainer);\r\n    },\r\n  };\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AACA,IAAkB,UAajB,CAAA;AAbD,CAAA,UAAkB,UAAU,EAAA;;;;;;AAM1B,IAAA,UAAA,CAAA,UAAA,CAAA,SAAA,CAAA,GAAA,CAAA,CAAA,GAAA,SAAW,CAAA;;AAEX,IAAA,UAAA,CAAA,UAAA,CAAA,oBAAA,CAAA,GAAA,CAAA,CAAA,GAAA,oBAA2B,CAAA;;AAE3B,IAAA,UAAA,CAAA,UAAA,CAAA,eAAA,CAAA,GAAA,CAAA,CAAA,GAAA,eAAsB,CAAA;;AAEtB,IAAA,UAAA,CAAA,UAAA,CAAA,gBAAA,CAAA,GAAA,CAAA,CAAA,GAAA,gBAAuB,CAAA;AACzB,CAAC,EAbiB,UAAU,KAAV,UAAU,GAa3B,EAAA,CAAA,CAAA;;SCZe,WAAW,CAAC,IAAI,EAAE,KAAM,EAAE,QAAS,EAAA;AACjD,IAAA,IAAM,KAAK,GAAG;AACZ,QAAA,IAAI,EAAA,IAAA;AACJ,QAAA,KAAK,EAAA,KAAA;AACL,QAAA,QAAQ,EAAA,QAAA;AACR,QAAA,SAAS,EAAE,YAAY,CAAC,IAAI,CAAC;AAC7B,QAAA,EAAE,EAAE,IAAI;KACT,CAAC;;AAEF,IAAA,IAAI,OAAO,QAAQ,KAAK,QAAQ,EAAE;AAChC,QAAA,KAAK,CAAC,SAAS,IAAI,UAAU,CAAC,aAAa,CAAC;AAC7C,KAAA;AAAM,SAAA,IAAI,KAAK,CAAC,OAAO,CAAC,QAAQ,CAAC,EAAE;AAClC,QAAA,KAAK,CAAC,SAAS,IAAI,UAAU,CAAC,cAAc,CAAC;AAC9C,KAAA;AAED,IAAA,OAAO,KAAK,CAAC;AACf,CAAC;AAED,SAAS,YAAY,CAAC,IAAS,EAAA;IAC7B,OAAO,OAAO,IAAI,KAAK,QAAQ;UAC3B,UAAU,CAAC,OAAO;AACpB,UAAE,UAAU,CAAC,kBAAkB,CAAC;AACpC;;ICvBa,CAAC,GAAG,UAAC,IAAY,EAAE,KAAU,EAAE,QAA6B,EAAA;IACvE,OAAO,WAAW,CAAC,IAAI,EAAE,KAAK,EAAE,QAAQ,CAAC,CAAC;AAC5C;;ACHA,IAAM,mBAAmB,GAAG;;;IAG1B,GAAG,EAAE,UAAC,CAAC,EAAK,EAAA,OAAA,CAAC,CAAC,KAAK,CAAC,EAAE,CAAA,EAAA;CACvB,CAAC;AAEF;AACO,IAAM,2BAA2B,GAAG;IACzC,GAAG,EAAA,UAAC,EAAe,EAAE,GAAG,EAAA;AAAf,QAAA,IAAA,QAAQ,GAAA,EAAA,CAAA,CAAA,CAAA;;AAEP,QAAA,IAAA,UAAU,GAAK,QAAQ,CAAA,UAAb,CAAc;QAChC,IAAI,GAAG,IAAI,UAAU,EAAE;AACrB,YAAA,OAAO,UAAU,CAAC,GAAG,CAAC,CAAC;AACxB,SAAA;AACD,QAAA,IAAM,YAAY,GAAG,mBAAmB,CAAC,GAAG,CAAC,CAAC;AAE9C,QAAA,IAAI,YAAY,EAAE;AAChB,YAAA,OAAO,YAAY,CAAC,QAAQ,CAAC,CAAC;AAC/B,SAAA;KACF;CACF;;AClBK,SAAU,uBAAuB,CAAC,KAAK,EAAA;AAC3C,IAAA,IAAM,SAAS,GAAG;QAChB,IAAI,EAAE,KAAK,CAAC,IAAI;AAChB,QAAA,KAAK,EAAA,KAAA;AACL,QAAA,UAAU,EAAE,EAAE;KACf,CAAC;AAEF,IAAA,OAAO,SAAS,CAAC;AACnB,CAAC;AAEK,SAAU,cAAc,CAAC,QAAQ,EAAA;;;IAIrC,sBAAsB,CAAC,QAAQ,CAAC,CAAC;AACnC,CAAC;AAED,SAAS,sBAAsB,CAAC,QAAa,EAAA;;AAE3C,IAAA,IAAM,SAAS,GAAG,QAAQ,CAAC,IAAI,CAAC;;AAEhC,IAAA,QAAQ,CAAC,KAAK,GAAG,IAAI,KAAK,CAAC,EAAE,CAAC,EAAE,QAAQ,EAAE,EAAE,2BAA2B,CAAC,CAAC;AAEjE,IAAA,IAAA,KAAK,GAAK,SAAS,CAAA,KAAd,CAAe;AAC5B,IAAA,IAAI,KAAK,EAAE;;AAGT,QAAA,IAAM,WAAW,GAAG,KAAK,EAAE,CAAC;AAC5B,QAAA,iBAAiB,CAAC,QAAQ,EAAE,WAAW,CAAC,CAAC;AAC1C,KAAA;AACH,CAAC;AAED,SAAS,iBAAiB,CAAC,QAAa,EAAE,WAAgB,EAAA;AACxD,IAAA,IAAI,OAAO,WAAW,KAAK,QAAQ,EAAE;AACnC,QAAA,QAAQ,CAAC,UAAU,GAAG,WAAW,CAAC;AACnC,KAAA;IAED,oBAAoB,CAAC,QAAQ,CAAC,CAAC;AACjC,CAAC;AAED,SAAS,oBAAoB,CAAC,QAAa,EAAA;AACzC,IAAA,IAAM,SAAS,GAAG,QAAQ,CAAC,IAAI,CAAC;IAChC,IAAI,SAAS,CAAC,MAAM,EAAE;AACpB,QAAA,QAAQ,CAAC,MAAM,GAAG,SAAS,CAAC,MAAM,CAAC;AACpC,KAAA;AACH;;AC3CgB,SAAA,MAAM,CAAC,KAAK,EAAE,SAAS,EAAA;;AAErC,IAAA,KAAK,CAAC,KAAK,EAAE,SAAS,CAAC,CAAC;AAC1B,CAAC;AAED,SAAS,KAAK,CAAC,KAAK,EAAE,SAAS,EAAA;;;;;AAKrB,IAAA,IAAA,SAAS,GAAK,KAAK,CAAA,SAAV,CAAW;AAE5B,IAAA,IAAI,SAAS,GAAG,UAAU,CAAC,OAAO,EAAE;AAClC,QAAA,cAAc,CAAC,KAAK,EAAE,SAAS,CAAC,CAAC;AAClC,KAAA;AAAM,SAAA,IAAI,SAAS,GAAG,UAAU,CAAC,kBAAkB,EAAE;AACpD,QAAA,gBAAgB,CAAC,KAAK,EAAE,SAAS,CAAC,CAAC;AACpC,KAAA;AACH,CAAC;AACD,SAAS,cAAc,CAAC,KAAU,EAAE,SAAc,EAAA;;AAEhD,IAAA,YAAY,CAAC,KAAK,EAAE,SAAS,CAAC,CAAC;AACjC,CAAC;AAED,SAAS,gBAAgB,CAAC,KAAK,EAAE,SAAS,EAAA;AACxC,IAAA,cAAc,CAAC,KAAK,EAAE,SAAS,CAAC,CAAC;AACnC,CAAC;AAED,SAAS,YAAY,CAAC,KAAU,EAAE,SAAc,EAAA;AAC9C,IAAA,IAAM,EAAE,IAAI,KAAK,CAAC,EAAE,GAAG,QAAQ,CAAC,aAAa,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC,CAAC;;IAEnD,IAAA,QAAQ,GAAgB,KAAK,CAAA,QAArB,EAAE,SAAS,GAAK,KAAK,CAAA,SAAV,CAAW;AACtC,IAAA,IAAI,SAAS,GAAG,UAAU,CAAC,aAAa,EAAE;AACxC,QAAA,EAAE,CAAC,WAAW,GAAG,QAAQ,CAAC;AAC3B,KAAA;AAAM,SAAA,IAAI,SAAS,GAAG,UAAU,CAAC,cAAc,EAAE;;AAEhD,QAAA,aAAa,CAAC,KAAK,EAAE,EAAE,CAAC,CAAC;AAC1B,KAAA;;AAEO,IAAA,IAAA,KAAK,GAAK,KAAK,CAAA,KAAV,CAAW;AAExB,IAAA,KAAK,IAAM,GAAG,IAAI,KAAK,EAAE;AACvB,QAAA,IAAM,GAAG,GAAG,KAAK,CAAC,GAAG,CAAC,CAAC;AACvB,QAAA,EAAE,CAAC,YAAY,CAAC,GAAG,EAAE,GAAG,CAAC,CAAC;AAC3B,KAAA;AACD,IAAA,SAAS,CAAC,MAAM,CAAC,EAAE,CAAC,CAAC;AACvB,CAAC;AAED,SAAS,aAAa,CAAC,KAAK,EAAE,SAAS,EAAA;AACrC,IAAA,KAAK,CAAC,QAAQ,CAAC,OAAO,CAAC,UAAC,CAAC,EAAA;AACvB,QAAA,KAAK,CAAC,CAAC,EAAE,SAAS,CAAC,CAAC;AACtB,KAAC,CAAC,CAAC;AACL,CAAC;AAED,SAAS,cAAc,CAAC,YAAiB,EAAE,SAAS,EAAA;AAClD,IAAA,IAAM,QAAQ,GAAG,uBAAuB,CAAC,YAAY,CAAC,CAAC;IACvD,cAAc,CAAC,QAAQ,CAAC,CAAC;AACzB,IAAA,iBAAiB,CAAC,QAAQ,EAAE,YAAY,EAAE,SAAS,CAAC,CAAC;AACvD,CAAC;AAED,SAAS,iBAAiB,CAAC,QAAa,EAAE,YAAiB,EAAE,SAAS,EAAA;AAC5D,IAAA,IAAA,KAAK,GAAK,QAAQ,CAAA,KAAb,CAAc;IAC3B,IAAM,OAAO,GAAG,QAAQ,CAAC,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;;;AAK5C,IAAA,KAAK,CAAC,OAAO,EAAE,SAAS,CAAC,CAAC;AAE1B,IAAA,YAAY,CAAC,EAAE,GAAG,OAAO,CAAC,EAAE,CAAC;AAC/B;;ACtEM,SAAU,SAAS,CAAC,aAAa,EAAA;IACrC,OAAO;AACL,QAAA,KAAK,YAAC,aAAa,EAAA;;;AAGjB,YAAA,IAAM,KAAK,GAAG,WAAW,CAAC,aAAa,CAAC,CAAC;AAEzC,YAAA,MAAM,CAAC,KAAK,EAAE,aAAa,CAAC,CAAC;SAC9B;KACF,CAAC;AACJ;;;;;"}